{"ts":1341776407506,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"// Users Controller\r\n// ================\r\n\r\n\r\n// Import User Model\r\nvar User = Mongoose.model('User');\r\n\r\nmodule.exports = function(app) {\r\n\r\n// Show the users Profile\r\n    app.get('/users/:username.:format?', requiresLogin, function(req, res) {\r\n        User.findOne({__id:req.params.id, user_id: req.currentUser.id}, function(err, user) {\r\n           if(!user) return next(new NotFound('User not Found')); \r\n           \r\n            switch (req.params.format) {\r\n                case 'json':\r\n                    res.send(user.toObject());\r\n                break;\r\n                \r\n                default:\r\n                    res.render('users/show', {user: user, currentUser: req.session.currentUser});\r\n            }\r\n        });\r\n    });\r\n    \r\n\r\n// Create New User Account\r\n    app.get('/users/new', function(req,res) {\r\n        res.render('users/new', {locals: {\r\n                    user: new User(), \r\n                    title: 'Register'\r\n        }});\r\n    });\r\n    \r\n    app.post('/users.:format?', function(req, res) {\r\n        var user = new User(req.body);\r\n\r\n        function userSaved() {\r\n            switch (req.params.format) {\r\n            case 'json':\r\n                res.send(user.toObject());\r\n            break;\r\n\r\n            default:\r\n                req.session.currentUser = user;\r\n                res.redirect('/');\r\n            }\r\n        }\r\n\r\n        function userSaveFailed() {\r\n            req.flash('warn', \"User creation failed.  Please see your administrator\");\r\n            res.render('./users/new', {\r\n                    locals: {user: user}\r\n            });\r\n        }\r\n\r\n        user.save(function(err) {\r\n            if (err) {\r\n               userSaveFailed();\r\n            } else {\r\n                userSaved();\r\n            }\r\n         });\r\n    });\r\n};"]],"start1":0,"start2":0,"length1":0,"length2":1802}]],"length":1802}
