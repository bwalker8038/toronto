{"ts":1341871796008,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"// Sessions Controller\n// ===================\n\n// Import User Model\nvar User = mongoose.model('User');\n\nmodule.exports = function(app) {\n\n// Create Session at User Sign In\n    app.get('/sessions/new', function(req, res) {\n        res.render('sessions/new', {locals: { \n                    user: new User(),\n                    title: 'Sign In', \n                    redir: req.query.redir \n        }}); \n    });\n    \n// Destroy Session at User Sign Off\n    app.get('sessions/destroy', function(req, res) {\n        delete req.session.user;\n        req.flash(\"You have successfully logged out.\");\n        res.redirect('/sessions/new');\n    });\n\n// POST Session Handler\n    app.post('/sessions', function(req, res) {\n        User.findOne({ username: req.body.username }, function(err, user) {\n            var rurl = '/', query = url.parse(req.url, true).query;\n\n          if(user && user.authenticate(req.body.password)) {\n                req.session.currentUser = user;\n                if(query.redirect) {\n                    rurl = decodeURIComponent(query.redirect);\n                }\n                req.flash('info', 'Hello %s', user.username);\n                res.redirect(rurl);\n            } else {\n                req.flash('warn', \"Login failed.  Please check your username and/or password.\");\n                res.redirect('/sessions/new');\n            }\n        });\n    });\n};"]],"start1":0,"start2":0,"length1":0,"length2":1385}]],"length":1385}
